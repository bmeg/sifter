
name: gdc
outdir: ../../out

config:
  cases: ../../resources/case.json
  schema: ../../resources/schemas

inputs:
  caseData:
    jsonLoad:
      input: "{{config.cases}}"

pipelines:
  caseObject:
    - from: caseData
    - project:
        mapping:
          studies: "{{row.project.project_id}}"
          experiments: "exp:{{row.project.project_id}}"
          type: case
    - objectValidate:
        title: Case
        schema: "{{config.schema}}"
    - emit:
        name: case
  
  caseGraph:
    - from: caseObject
    - graphBuild:
        schema: "{{config.schema}}"
        #idPrefix: Case
        title: Case
  
  sampleData:
    - from: caseData
    - fieldProcess:
        field: samples
        mapping:
          cases: "{{row.id}}"

  sampleObject:
    - from: sampleData
    - project:
        mapping:
          type: sample
          id: "{{row.sample_id}}"
    - objectValidate:
        title: Sample
        schema: "{{config.schema}}"
    - emit:
        name: sample

  sampleGraph:
    - from: sampleObject
    - graphBuild:
        schema: "{{config.schema}}"
        #idPrefix: Sample
        title: Sample

  aliquotObject:
    - from: sampleData
    - fieldProcess:
        field: portions
        mapping:
          samples: "{{row.id}}"
    - fieldProcess:
        field: analytes
        mapping:
          samples: "{{row.samples}}"
    - fieldProcess:
        field: aliquots
        mapping:
          samples: "{{row.samples}}"
    - project:
        mapping:
          type: aliquot
          id: "{{row.aliquot_id}}"
    - objectValidate:
        title: Aliquot
        schema: "{{config.schema}}"
    - emit:
        name: aliquot

  aliquotGraph:
    - from: aliquotObject
    - graphBuild:
        schema: "{{config.schema}}"
        #idPrefix: Aliquot
        title: Aliquot
