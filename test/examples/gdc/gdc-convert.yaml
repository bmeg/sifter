
inputs:
  cases:
    type: File

sources:
  caseData:
    jsonLoad:
      input: "{{inputs.cases}}"


links:
  - from: caseData
    to: caseMapping
  - from: caseData
    to: samplesMapping

pipelines:
  caseMapping:
    - project:
        mapping:
          studies: "{{row.project.project_id}}"
          experiments: "exp:{{row.project.project_id}}"
          type: case
    - objectCreate:
        class: case
  
  samplesMapping:
    - fieldProcess:
        field: samples
        mapping:
          cases: "{{row.id}}"
    - project:
        mapping:
          type: sample
          id: "{{row.sample_id}}"
    - objectCreate:
        class: sample
    - fieldProcess:
        field: portions
        mapping:
          samples: "{{row.id}}"
    - fieldProcess:
        field: analytes
        mapping:
          samples: "{{row.samples}}"
    - fieldProcess:
        field: aliquots
        mapping:
          samples: "{{row.samples}}"
    - project:
        mapping:
          type: aliquot
          id: "{{row.aliquot_id}}"
    - objectCreate:
        class: aliquot
